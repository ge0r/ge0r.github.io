<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>geor@home/posts/openqa-module-mapper/</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><link rel=stylesheet href=https://ge0r.github.io/hugo-theme-console/css/terminal-0.7.1.min.css><link rel=stylesheet href=https://ge0r.github.io/hugo-theme-console/css/animate-3.7.2.min.css><link rel=stylesheet href=https://ge0r.github.io/hugo-theme-console/css/console.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel="shortcut icon" type=image/x-icon href=/images/geor.jpg><meta property="og:title" content="Find where an openQA module is running"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://ge0r.github.io/posts/openqa-module-mapper/"><meta property="article:published_time" content="2021-06-14T12:07:57+02:00"><meta name=twitter:title content="Find where an openQA module is running"><meta name=twitter:description content="There is never a bad excuse to write a web scraper in Go."></head><body class=terminal><div class=container><div class=terminal-nav><header class=terminal-logo><div class="logo terminal-prompt"><a href=https://ge0r.github.io/ class="no-style site-name">geor@home</a>:~$
<a href=https://ge0r.github.io/posts>posts</a>/<a href=https://ge0r.github.io/posts/openqa-module-mapper>openqa-module-mapper</a>/</div></header><nav class=terminal-menu><ul vocab="https://schema.org/" typeof="BreadcrumbList"><li><a href=https://ge0r.github.io/about/ typeof="ListItem">about/</a></li><li><a href=https://ge0r.github.io/posts/ typeof="ListItem">posts/</a></li></ul></nav></div></div><div class=container><h1>Find where an openQA module is running</h1>Jun. 14, 2021<br><br><p><em>There is never a bad excuse to write a web scraper in Go.</em></p><hr><h2 id=the-problem>The problem</h2><p>You might have heard of a tool called <a href=http://open.qa/>openQA</a>.<br>If not, the best way to understand how it works is with some hands on experience. I recommend following <a href=https://kalikiana.gitlab.io/post/2021-02-16-get-started-with-openqa-development/>get started with openqa development</a>, it will throw you right in.</p><p>Ok, now that we know what openQA does, let&rsquo;s hear a major hurdle from the people who use it daily:</p><blockquote><p>&ldquo;There is no good way to view all the places where an openQA module has been scheduled.&rdquo;<br>~ <em>some openQA test developer</em></p></blockquote><p>This lack of visibility can turn into quite an issue. To really understand what the deal is, let&rsquo;s clarify some stuff first:</p><ul><li>A module is the smallest testing block in openQA, and it is where the code that does the testing resides.</li><li>Modules running together in sequence form a job.</li><li>Anyone with access to an openQA instance can schedule a job. In the case of <a href=openqa.opensuse.org/>openqa.opensuse.org</a> for example, this is anyone with an opensuse account.</li></ul><p>This means that when an openQA test developer changes the code of a module, this could affect an undefined number of jobs, that could be testing different systems. The developer&rsquo;s code might break one or more of these jobs, which can be running on a regular basis, being scheduled by a not-so-visible mechanism.</p><p>All well-intentioned test developers will try to be proactive about potential issues caused by their code changes. This means that they will need to find, for a specific openQA instance, all the jobs that contain the module(s) affected by their code changes, and verify that no side effects arise.<br>However, as you might have guessed, there is no good way to list all jobs that contain a specific module.</p><hr><h2 id=the-solution>The solution</h2><p>Enter the <a href=https://github.com/ge0r/openQA-module-mapper>openqa-module-mapper</a>.<br><em>Shameless plug</em>: It is a web scrapper written in Go by <a href=https://github.com/punkioudi>Anna Minou</a> and <a href=https://github.com/ge0r>George Gkioulis</a> for SUSE Hack Week 2021.</p><p>The scraper parses <a href=openqa.opensuse.org>openqa.opensuse.org</a> daily, visiting all links that a user would, and mapping the jobs of Job Groups' most recent builds. This allows the test developer to have an aggregated daily overview of which modules run in which jobs and which of these modules failed.<br>Today&rsquo;s results can be seen in the <a href=https://raw.githubusercontent.com/ge0r/openQA-module-mapper/o3/o3.log>output log</a>.</p><p>Right now the worfklow is pretty basic.<br>Let&rsquo;s say you want to change the <code>tests/containers/docker_runc</code> module:</p><ul><li>Search in <a href=https://raw.githubusercontent.com/ge0r/openQA-module-mapper/o3/o3.log>today&rsquo;s output log</a> for that module. You now know which jobs you might need to clone for your verification runs.</li><li>You have an extensive overview of which products and flavors your test module is running against.</li><li>You have visibility on which <code>YAML_SCHEDULE</code> file is used for each job, in case you wish to modify the schedule (and want to know which jobs will be affected).</li></ul><hr><h2 id=the-implementation>The implementation</h2><p>The <a href=https://github.com/ge0r/openQA-module-mapper>project repository</a> is open for everyone interested, PRs and feature requests are welcome!<br>We wrote <em>openqa-module-mapper</em> solely in the Go language, using <a href=https://github.com/PuerkitoBio/goquery>goquery</a>, which brings jQuery functionality to Go.
The project is in essence a web scrapper that gathers job and module information from a given openQA instance.</p><p>Currently the o3 scraper runs once every night based on this <a href=https://github.com/ge0r/openQA-module-mapper/blob/o3/.github/workflows/o3-schedule.yaml>github actions workflow</a>.<br>The o3 nightly logs can be found in the o3 branch, <a href=https://raw.githubusercontent.com/ge0r/openQA-module-mapper/o3/o3.log>here</a>.<br>One can also <code>git diff</code> the o3.log between different dates in order to see how the results change, what was scheduled and what was unscheduled.</p><hr><h2 id=future-improvements>Future improvements</h2><p>The following are in our todo list:</p><ul><li>Store the required data in a time series database instead of versioning the logs in git.</li><li>If the latest build still has unfinished jobs, move to the next build. Right now this is mitigated by the scraper&rsquo;s schedule.</li><li>Implement a CLI interface for the <em>openqa-module-mapper</em>.</li><li>Pass a configuration file to specify which Job Groups to whitelist or blacklist, and other user defined specifications.</li></ul><div class=footer>Powered by <a href=https://gohugo.io/>Hugo</a> with
<a href=https://github.com/mrmierzejewski/hugo-theme-console/>Console Theme</a>.</div></div></body></html>